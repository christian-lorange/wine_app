<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>My Wine</title>
        <link rel="stylesheet" href="assets/css/foundation.min.css">
        <link rel="stylesheet" href="assets/css/bootstrap.css">
        <link rel="stylesheet" href="assets/css/style.css">
        
    </head>
    <body>

<form>
<div class="form-group">
<label for="exampleInputEmail1">WorkFlow by Request ID</label>
<input type="text" class="form-control" id="search" placeholder="Request #">
</div>
<button type="submit" class="btn btn-default" id="btnSearch">Submit</button>
</form> 

<div class="row" id="content">
                <div class="medium-12 columns" id="wine-content"></div>
</div>


<script type="text/javascript">

  

    var button = document.getElementById("btnSearch");

    button.onclick = function () {
    var text = document.getElementById("search").value;
    
    var ul=("https://wine.orangehousellc.com/wp-json/wp/v2/posts?search=" + text);
  

    const RESTURL = 'https://wine.orangehousellc.com/wp-json/';
  
    var app = {
        
        init : function() {
            
            this.getSiteData()
            this.loadwine()
            this.loadblog()
       
           /* this.loadCategories() */
            this.loadActions()
    
            
        },
        
        loadActions : function() {
            
            $( '#wine-content' ).on( 'click', '.blog-post h3', this.loadwineposts )
            $( '#wine-content' ).on( 'click', '.blog-post .thumbnail', this.loadwineposts )
            $( '#blog' ).on( 'click', '.blog-post h3', this.loadblogpost )
            $( '#blog' ).on( 'click', '.blog-post .thumbnail', this.loadblogpost )
           
            
        },
        
        getSiteData : function() {
            
            $.get( RESTURL )
                .done( function( response ) {
                    $( '.site-title' ).html( response.name )
                    $( '.description' ).html( response.description )
                })
                .fail( function() {
                    alert( 'failed to call specified URL' )
                })

        },
        
        loadwine : function() {
            
            var url = 'wp/v2/product?search='+text+'&_embed=true&per_page=100'
            
            $.get( url )
                .done( function( response ) {
                    
                    var wine = {
                        wine: response
                    }
                    
                    var template = $( '#blog-post-template' ).html()
                    var output = $( '#wine-content' )
                                        
                    var result = Mustache.to_html( template, wine )
                    output.append( result )
                    
                })
                .fail( function() {
                    alert( 'cannot load posts' )
                })

        },

        
       
        
        

        loadblog : function() {

               var url = RESTURL + 'wp/v2/posts?_embed'

                $.get( url )
                .done( function( response ) {
                    
                    var posts = {
                        posts: response
                    }
                    
                    var template = $( '#blog-post-template' ).html()
                    var output_posts = $( '#blog' )
                                        
                    var result = Mustache.to_html( template, posts )
                    output_posts.append( result)
                    
                })
                .fail( function() {
                    alert( 'cannot load posts' )
                })
            
        },
        
        
        loadwineposts : function() {
            
            var id = Math.abs( $( this ).parent( '.blog-post' ).data( 'id' ) )
            var url = RESTURL + 'wp/v2/product/' + id + '?_embed'
            
            $.get( url )
                .done( function( response ) {

                    
                    var template = $( '#single-post-template' ).html()
                    var output = $( '#wine-content' )
                                        
                    var result = Mustache.to_html( template, response )
                    output.html( result )

                    $(document).ready(function(){
                    $(this).scrollTop(0);
                });


                    
                })
                .fail( function() {
                    alert( 'cannot load post' )
                })
            
        },

            

        


        loadblogpost : function() {
            
            var id2 = Math.abs( $( this ).parent( '.blog-post' ).data( 'id' ) )
            var url = RESTURL + 'wp/v2/posts/' + id2 + '?_embed'
            
            $.get( url )
                .done( function( response ) {

                    
                    var template = $( '#single-post-template' ).html()
                    var output_posts = $( '#blog' )
                                        
                    var result = Mustache.to_html( template, response )
                    output_posts.html( result )

                    $(document).ready(function(){
                    $(this).scrollTop(0);
});

                    
                })
                .fail( function() {
                    alert( 'cannot load post' )
                })
            
        }
   
        
    }

    app.init();




									};                    

      

       </script>


 <script type="text/template" id="blog-post-template">

        {{#wine}}
        <div class="blog-post" data-id="{{id}}">
            <h3>{{title.rendered}}</h3>
            <img class="thumbnail" src="{{_embedded.wp:featuredmedia.0.source_url}}">
        </div>
        {{/wine}}

        </script>


        <!-- External javascript -->
        <script src="includes/lib/js/jquery.min.js"></script>
        <script src="includes/lib/js/mustache.min.js"></script>
        <script src="includes/app/bootstrap.js"></script>
        <script src="includes/app/npm.js"></script>
        <script src="includes/app/custom.js"></script>   
 <!-- End of external javascript -->    

    </body>
    </html>